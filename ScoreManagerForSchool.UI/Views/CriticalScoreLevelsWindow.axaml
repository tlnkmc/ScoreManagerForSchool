<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ScoreManagerForSchool.UI.ViewModels"
        xmlns:core="using:ScoreManagerForSchool.Core.Storage"
        x:Class="ScoreManagerForSchool.UI.Views.CriticalScoreLevelsWindow"
        x:DataType="vm:CriticalScoreLevelsViewModel"
        Title="关键积分阈值设置"
        Width="600"
        Height="500"
        MinWidth="500"
        MinHeight="400"
        Icon="/Assets/avalonia-logo.ico"
        WindowStartupLocation="CenterOwner">

  <Design.DataContext>
    <vm:CriticalScoreLevelsViewModel/>
  </Design.DataContext>

  <Grid RowDefinitions="Auto,*,Auto" Margin="16">
    <!-- 标题和说明 -->
    <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,16">
      <TextBlock Text="关键积分阈值设置" 
                FontSize="18" 
                FontWeight="Bold" 
                Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
      <TextBlock Text="设置学生积分达到指定阈值时的显示颜色和等级名称。积分大于等于阈值时将被标记为对应等级。" 
                TextWrapping="Wrap"
                Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
    </StackPanel>

    <!-- 等级列表 -->
    <Border Grid.Row="1" 
            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" 
            BorderThickness="1" 
            CornerRadius="8" 
            Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}">
      <Grid RowDefinitions="Auto,*">
        <!-- 列标题 -->
        <Grid Grid.Row="0" 
              ColumnDefinitions="120,*,80,120,Auto" 
              Margin="12,8" 
              Height="32">
          <TextBlock Grid.Column="0" 
                    Text="阈值" 
                    FontWeight="SemiBold" 
                    VerticalAlignment="Center"
                    Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
          <TextBlock Grid.Column="1" 
                    Text="等级名称" 
                    FontWeight="SemiBold" 
                    VerticalAlignment="Center"
                    Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
          <TextBlock Grid.Column="2" 
                    Text="颜色" 
                    FontWeight="SemiBold" 
                    VerticalAlignment="Center"
                    Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
          <TextBlock Grid.Column="3" 
                    Text="预览" 
                    FontWeight="SemiBold" 
                    VerticalAlignment="Center"
                    Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
          <TextBlock Grid.Column="4" 
                    Text="操作" 
                    FontWeight="SemiBold" 
                    VerticalAlignment="Center"
                    Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
        </Grid>

        <!-- 等级列表 -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
          <ItemsControl ItemsSource="{Binding Levels}" Margin="8">
            <ItemsControl.ItemTemplate>
              <DataTemplate x:DataType="core:CriticalScoreLevel">
                <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                        BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="8"
                        Margin="4">
                  <Grid ColumnDefinitions="120,*,80,120,Auto" ColumnSpacing="8">
                    <!-- 阈值输入 -->
                    <NumericUpDown Grid.Column="0" 
                                  Value="{Binding Threshold, Mode=TwoWay}"
                                  Minimum="0"
                                  Maximum="999"
                                  Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                                  BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                                  CornerRadius="4"/>

                    <!-- 等级名称输入 -->
                    <TextBox Grid.Column="1" 
                            Text="{Binding Name, Mode=TwoWay}"
                            Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                            Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                            CornerRadius="4"/>

                    <!-- 颜色选择器 -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
                      <Border Width="24" 
                              Height="24" 
                              CornerRadius="12"
                              BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                              BorderThickness="1">
                        <Border.Background>
                          <SolidColorBrush Color="{Binding Color, Converter={StaticResource StringToColorConverter}}"/>
                        </Border.Background>
                      </Border>
                      <TextBox Text="{Binding Color, Mode=TwoWay}"
                              Width="50"
                              FontSize="10"
                              Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                              Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                              BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                              CornerRadius="4"/>
                    </StackPanel>

                    <!-- 预览 -->
                    <Border Grid.Column="3" 
                            CornerRadius="4" 
                            Padding="8,4"
                            BorderThickness="1"
                            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}">
                      <Border.Background>
                        <SolidColorBrush Color="{Binding Color, Converter={StaticResource StringToColorConverter}}" Opacity="0.2"/>
                      </Border.Background>
                      <TextBlock Text="{Binding Name}" 
                                FontSize="12"
                                HorizontalAlignment="Center"
                                Foreground="{Binding Color, Converter={StaticResource StringToBrushConverter}}"/>
                    </Border>

                    <!-- 删除按钮 -->
                    <Button Grid.Column="4" 
                            Content="删除"
                            Background="{DynamicResource SystemControlErrorTextBrush}"
                            Foreground="{DynamicResource SystemControlForegroundChromeWhiteBrush}"
                            BorderBrush="{DynamicResource SystemControlErrorTextBrush}"
                            CornerRadius="4"
                            Padding="8,4"
                            FontSize="12"
                            Command="{Binding $parent[ItemsControl].DataContext.RemoveLevelCommand}"
                            CommandParameter="{Binding}">
                      <Button.Styles>
                        <Style Selector="Button:pointerover">
                          <Setter Property="Background" Value="{DynamicResource SystemControlErrorTextBrush}"/>
                          <Setter Property="Opacity" Value="0.8"/>
                        </Style>
                      </Button.Styles>
                    </Button>
                  </Grid>
                </Border>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </ScrollViewer>
      </Grid>
    </Border>

    <!-- 底部按钮 -->
    <Grid Grid.Row="2" ColumnDefinitions="Auto,*,Auto,Auto,Auto,Auto" ColumnSpacing="8" Margin="0,16,0,0">
      <Button Grid.Column="0" 
              Content="添加等级" 
              Command="{Binding AddLevelCommand}"
              Background="{DynamicResource SystemControlAccentBrush}"
              Foreground="{DynamicResource SystemControlForegroundChromeWhiteBrush}"
              BorderBrush="{DynamicResource SystemControlAccentBrush}"
              CornerRadius="6"
              Padding="16,8">
        <Button.Styles>
          <Style Selector="Button:pointerover">
            <Setter Property="Background" Value="{DynamicResource SystemControlAccentDark1Brush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource SystemControlAccentDark1Brush}"/>
          </Style>
        </Button.Styles>
      </Button>
      
      <Button Grid.Column="2" 
              Content="重置默认" 
              Command="{Binding ResetCommand}"
              Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
              Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
              BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
              CornerRadius="6"
              Padding="16,8">
        <Button.Styles>
          <Style Selector="Button:pointerover">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
          </Style>
        </Button.Styles>
      </Button>
      
      <Button Grid.Column="3" 
              Content="取消" 
              Command="{Binding CancelCommand}"
              Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
              Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
              BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
              CornerRadius="6"
              Padding="16,8">
        <Button.Styles>
          <Style Selector="Button:pointerover">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
          </Style>
        </Button.Styles>
      </Button>
      
      <Button Grid.Column="4" 
              Content="保存" 
              Command="{Binding SaveCommand}"
              Background="{DynamicResource SystemControlAccentBrush}"
              Foreground="{DynamicResource SystemControlForegroundChromeWhiteBrush}"
              BorderBrush="{DynamicResource SystemControlAccentBrush}"
              CornerRadius="6"
              Padding="16,8">
        <Button.Styles>
          <Style Selector="Button:pointerover">
            <Setter Property="Background" Value="{DynamicResource SystemControlAccentDark1Brush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource SystemControlAccentDark1Brush}"/>
          </Style>
        </Button.Styles>
      </Button>
    </Grid>
  </Grid>
</Window>
