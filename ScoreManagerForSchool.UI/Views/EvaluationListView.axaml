<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:ScoreManagerForSchool.UI.ViewModels"
             xmlns:core="using:ScoreManagerForSchool.Core.Storage"
             x:Class="ScoreManagerForSchool.UI.Views.EvaluationListView"
             x:DataType="vm:EvaluationListViewModel"
             x:Name="Root">

  <ScrollViewer>
    <Border Padding="12">
    <StackPanel Spacing="12">
      <TextBlock Text="积分记录管理" 
                FontSize="20" 
                FontWeight="Bold" 
                Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>

      <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
        <TextBox Width="300" 
                Watermark="搜索 (姓名/学号/班级/备注/教师)" 
                Text="{Binding Query, Mode=TwoWay}"
                Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                CornerRadius="6"/>
        <Button Content="刷新" 
               Command="{Binding RefreshCommand}"
               Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
               Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
               BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
               CornerRadius="6"
               Padding="12,6">
          <Button.Styles>
            <Style Selector="Button:pointerover">
              <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
              <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundAccentBrush}"/>
            </Style>
            <Style Selector="Button:pressed">
              <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumBrush}"/>
            </Style>
          </Button.Styles>
        </Button>
        <Button Content="添加记录" 
               Command="{Binding AddCommand}"
               Background="{DynamicResource SystemControlAccentBrush}"
               Foreground="{DynamicResource SystemControlForegroundChromeWhiteBrush}"
               BorderBrush="{DynamicResource SystemControlAccentBrush}"
               CornerRadius="6"
               Padding="12,6">
          <Button.Styles>
            <Style Selector="Button:pointerover">
              <Setter Property="Background" Value="{DynamicResource SystemControlAccentDark1Brush}"/>
              <Setter Property="BorderBrush" Value="{DynamicResource SystemControlAccentDark1Brush}"/>
            </Style>
            <Style Selector="Button:pressed">
              <Setter Property="Background" Value="{DynamicResource SystemControlAccentDark2Brush}"/>
            </Style>
          </Button.Styles>
        </Button>
      </StackPanel>

      <!-- 筛选条件面板 - 主题适配版本 -->
      <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" 
              BorderThickness="1" 
              CornerRadius="8" 
              Padding="12" 
              Background="{DynamicResource SystemControlBackgroundAltHighBrush}">
        <StackPanel Spacing="12">
          <TextBlock Text="筛选条件" 
                    FontWeight="SemiBold" 
                    FontSize="16" 
                    Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
          <StackPanel Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="班级:" 
                        VerticalAlignment="Center" 
                        MinWidth="90" 
                        Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
              <ComboBox Width="120" 
                       ItemsSource="{Binding ClassOptions}" 
                       SelectedItem="{Binding SelectedClass, Mode=TwoWay}"
                       Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                       Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                       BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                       CornerRadius="6"/>
            </StackPanel>
            
            <!-- 日期选择区域 - 移除边框 -->
            <StackPanel Orientation="Horizontal" Spacing="16">
              <!-- 开始日期 -->
              <StackPanel Orientation="Horizontal" Spacing="6">
                <TextBlock Text="📅" 
                          VerticalAlignment="Center" 
                          FontSize="16" 
                          Foreground="{DynamicResource SystemControlForegroundAccentBrush}"/>
                <TextBlock Text="开始:" 
                          VerticalAlignment="Center" 
                          FontWeight="Medium" 
                          Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                <Button Name="StartDateButton" 
                        Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                        Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                        BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12,6"
                        Width="140"
                        HorizontalContentAlignment="Center"
                        Click="OnStartDateButtonClick">
                  <TextBlock Text="{Binding StartDate, StringFormat={}{0:yyyy-MM-dd}, TargetNullValue=选择日期}"/>
                  <Button.Styles>
                    <Style Selector="Button:pointerover">
                      <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
                      <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundAccentBrush}"/>
                    </Style>
                    <Style Selector="Button:pressed">
                      <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumBrush}"/>
                    </Style>
                  </Button.Styles>
                </Button>
                  <Popup Name="StartDatePopup" 
                         IsLightDismissEnabled="True" 
                         PlacementTarget="{Binding ElementName=StartDateButton}"
                         Placement="Bottom"
                         HorizontalOffset="-10"
                         VerticalOffset="4">
                    <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" 
                            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
                            BorderThickness="1" 
                            CornerRadius="8"
                            Padding="16">
                      <Border.Effect>
                        <DropShadowEffect OffsetX="0" OffsetY="4" BlurRadius="16" Opacity="0.25"/>
                      </Border.Effect>
                      <Calendar Name="StartDateCalendar" 
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}">
                        <Calendar.Styles>
                          <!-- 日期按钮样式 -->
                          <Style Selector="CalendarDayButton">
                            <Setter Property="FontSize" Value="11"/>
                            <!-- 通过大圆角实现圆形外观，但不修改尺寸 -->
                            <Setter Property="CornerRadius" Value="999"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                          </Style>
                          
                          <!-- 悬浮效果 -->
                          <Style Selector="CalendarDayButton:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundListMediumBrush}"/>
                            <!-- 使用细描边营造圆形阴影的视觉，不改变大小 -->
                            <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundAccentBrush}"/>
                            <Setter Property="BorderThickness" Value="1"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                          </Style>
                          
                          <!-- 选中状态 -->
                          <Style Selector="CalendarDayButton:selected">
                            <Setter Property="Background" Value="{DynamicResource SystemControlAccentBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundChromeWhiteBrush}"/>
                          </Style>
                          
                          <!-- 选中+悬浮状态 -->
                          <Style Selector="CalendarDayButton:selected:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SystemControlAccentDark1Brush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundChromeWhiteBrush}"/>
                          </Style>
                          
                          <!-- 今天的特殊样式 -->
                          <Style Selector="CalendarDayButton:today">
                            <Setter Property="BorderBrush" Value="{DynamicResource SystemControlAccentBrush}"/>
                            <Setter Property="BorderThickness" Value="1"/>
                          </Style>
                          
                          <!-- 月份/年份标题样式 -->
                          <Style Selector="CalendarButton">
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="CornerRadius" Value="4"/>
                            <Setter Property="Padding" Value="6,3"/>
                          </Style>
                          
                          <Style Selector="CalendarButton:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundListMediumBrush}"/>
                          </Style>
                          
                          <!-- 导航按钮样式 -->
                          <Style Selector="RepeatButton">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                          </Style>
                          
                          <Style Selector="RepeatButton:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundListMediumBrush}"/>
                          </Style>
                        </Calendar.Styles>
                      </Calendar>
                    </Border>
                  </Popup>
                </StackPanel>
                
                <Rectangle Width="1" 
                          Height="24" 
                          Fill="{DynamicResource SystemControlForegroundBaseMediumLowBrush}" 
                          VerticalAlignment="Center"/>
                
                <!-- 结束日期 -->
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Text="📅" 
                            VerticalAlignment="Center" 
                            FontSize="16" 
                            Foreground="{DynamicResource SystemControlForegroundAccentBrush}"/>
                  <TextBlock Text="结束:" 
                            VerticalAlignment="Center" 
                            FontWeight="Medium" 
                            Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                  <Button Name="EndDateButton" 
                          Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                          Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                          BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                          BorderThickness="1"
                          CornerRadius="6"
                          Padding="12,6"
                          Width="140"
                          HorizontalContentAlignment="Center"
                          Click="OnEndDateButtonClick">
                    <TextBlock Text="{Binding EndDate, StringFormat={}{0:yyyy-MM-dd}, TargetNullValue=选择日期}"/>
                    <Button.Styles>
                      <Style Selector="Button:pointerover">
                        <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
                        <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundAccentBrush}"/>
                      </Style>
                      <Style Selector="Button:pressed">
                        <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumBrush}"/>
                      </Style>
                    </Button.Styles>
                  </Button>
                  <Popup Name="EndDatePopup" 
                         IsLightDismissEnabled="True" 
                         PlacementTarget="{Binding ElementName=EndDateButton}"
                         Placement="Bottom"
                         HorizontalOffset="-10"
                         VerticalOffset="4">
                    <Border Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}" 
                            BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}" 
                            BorderThickness="1" 
                            CornerRadius="8"
                            Padding="16">
                      <Border.Effect>
                        <DropShadowEffect OffsetX="0" OffsetY="4" BlurRadius="16" Opacity="0.25"/>
                      </Border.Effect>
                      <Calendar Name="EndDateCalendar" 
                                Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
                                Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}">
                        <Calendar.Styles>
                          <!-- 日期按钮样式 -->
                          <Style Selector="CalendarDayButton">
                            <Setter Property="FontSize" Value="11"/>
                            <Setter Property="CornerRadius" Value="999"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                          </Style>
                          
                          <!-- 悬浮效果 -->
                          <Style Selector="CalendarDayButton:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundListMediumBrush}"/>
                            <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundAccentBrush}"/>
                            <Setter Property="BorderThickness" Value="1"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                          </Style>
                          
                          <!-- 选中状态 -->
                          <Style Selector="CalendarDayButton:selected">
                            <Setter Property="Background" Value="{DynamicResource SystemControlAccentBrush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundChromeWhiteBrush}"/>
                          </Style>
                          
                          <!-- 选中+悬浮状态 -->
                          <Style Selector="CalendarDayButton:selected:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SystemControlAccentDark1Brush}"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundChromeWhiteBrush}"/>
                          </Style>
                          
                          <!-- 今天的特殊样式 -->
                          <Style Selector="CalendarDayButton:today">
                            <Setter Property="BorderBrush" Value="{DynamicResource SystemControlAccentBrush}"/>
                            <Setter Property="BorderThickness" Value="1"/>
                          </Style>
                          
                          <!-- 月份/年份标题样式 -->
                          <Style Selector="CalendarButton">
                            <Setter Property="FontSize" Value="12"/>
                            <Setter Property="FontWeight" Value="SemiBold"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="CornerRadius" Value="4"/>
                            <Setter Property="Padding" Value="6,3"/>
                          </Style>
                          
                          <Style Selector="CalendarButton:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundListMediumBrush}"/>
                          </Style>
                          
                          <!-- 导航按钮样式 -->
                          <Style Selector="RepeatButton">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                          </Style>
                          
                          <Style Selector="RepeatButton:pointerover">
                            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundListMediumBrush}"/>
                          </Style>
                        </Calendar.Styles>
                      </Calendar>
                    </Border>
                  </Popup>
                </StackPanel>
              </StackPanel>
            
            <CheckBox Content="仅显示扣分记录" 
                     IsChecked="{Binding ShowNegativeScoresOnly, Mode=TwoWay}"
                     Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                     Margin="0,8,0,0"/>
          </StackPanel>
          <!-- 时间快捷选择 -->
          <StackPanel Orientation="Horizontal" Spacing="12">
            <TextBlock Text="快捷时间:" 
                      VerticalAlignment="Center" 
                      FontWeight="Medium" 
                      Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
            <Button Content="今天" 
                   Click="OnSetToday" 
                   Padding="10,4"
                   Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                   BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                   CornerRadius="4"
                   FontSize="12">
              <Button.Styles>
                <Style Selector="Button:pointerover">
                  <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
                </Style>
              </Button.Styles>
            </Button>
            <Button Content="昨天" 
                   Click="OnSetYesterday" 
                   Padding="10,4"
                   Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                   BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                   CornerRadius="4"
                   FontSize="12">
              <Button.Styles>
                <Style Selector="Button:pointerover">
                  <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
                </Style>
              </Button.Styles>
            </Button>
            <Button Content="本周" 
                   Click="OnSetThisWeek" 
                   Padding="10,4"
                   Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                   BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                   CornerRadius="4"
                   FontSize="12">
              <Button.Styles>
                <Style Selector="Button:pointerover">
                  <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
                </Style>
              </Button.Styles>
            </Button>
            <Button Content="本月" 
                   Click="OnSetThisMonth" 
                   Padding="10,4"
                   Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                   BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                   CornerRadius="4"
                   FontSize="12">
              <Button.Styles>
                <Style Selector="Button:pointerover">
                  <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
                </Style>
              </Button.Styles>
            </Button>
            <Button Content="清除时间" 
                   Click="OnClearDates" 
                   Padding="10,4"
                   Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                   BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                   CornerRadius="4"
                   FontSize="12">
              <Button.Styles>
                <Style Selector="Button:pointerover">
                  <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
                </Style>
              </Button.Styles>
            </Button>
          </StackPanel>
        </StackPanel>
      </Border>

      <Grid ColumnDefinitions="220,100,120,*,80,100,100,Auto" 
            Margin="0,4" 
            Background="{DynamicResource SystemControlBackgroundAltMediumBrush}"
            Height="32">
        <TextBlock Grid.Column="0" 
                  Text="日期" 
                  FontWeight="SemiBold" 
                  VerticalAlignment="Center" 
                  Margin="8,0"
                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
        <TextBlock Grid.Column="1" 
                  Text="班级" 
                  FontWeight="SemiBold" 
                  VerticalAlignment="Center" 
                  Margin="8,0"
                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
        <TextBlock Grid.Column="2" 
                  Text="学号" 
                  FontWeight="SemiBold" 
                  VerticalAlignment="Center" 
                  Margin="8,0"
                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
        <TextBlock Grid.Column="3" 
                  Text="姓名" 
                  FontWeight="SemiBold" 
                  VerticalAlignment="Center" 
                  Margin="8,0"
                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
        <TextBlock Grid.Column="4" 
                  Text="积分" 
                  FontWeight="SemiBold" 
                  VerticalAlignment="Center" 
                  Margin="8,0"
                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
        <TextBlock Grid.Column="5" 
                  Text="教师" 
                  FontWeight="SemiBold" 
                  VerticalAlignment="Center" 
                  Margin="8,0"
                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
        <TextBlock Grid.Column="6" 
                  Text="备注" 
                  FontWeight="SemiBold" 
                  VerticalAlignment="Center" 
                  Margin="8,0"
                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
        <TextBlock Grid.Column="7" 
                  Text="操作" 
                  FontWeight="SemiBold" 
                  VerticalAlignment="Center" 
                  Margin="8,0"
                  Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
      </Grid>
      
      <ListBox ItemsSource="{Binding Evaluations}" 
               SelectedItem="{Binding SelectedEvaluation, Mode=TwoWay}" 
               Height="400"
               Background="{DynamicResource SystemControlBackgroundChromeMediumLowBrush}"
               BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
               BorderThickness="1"
               CornerRadius="6">
        <ListBox.Styles>
          <Style Selector="ListBoxItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="CornerRadius" Value="4"/>
          </Style>
          <Style Selector="ListBoxItem:selected">
            <Setter Property="Background" Value="{DynamicResource SystemControlHighlightListAccentMediumBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundChromeWhiteBrush}"/>
          </Style>
          <Style Selector="ListBoxItem:pointerover">
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundListMediumBrush}"/>
          </Style>
        </ListBox.Styles>
        <ListBox.ItemTemplate>
          <DataTemplate x:DataType="core:EvaluationEntry">
            <Grid ColumnDefinitions="220,100,120,*,80,100,100,Auto" Margin="0,2">
              <Grid.Styles>
                <Style Selector="TextBox">
                  <Setter Property="MinWidth" Value="80"/>
                  <Setter Property="FontSize" Value="12"/>
                  <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseLowBrush}"/>
                  <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                  <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"/>
                  <Setter Property="CornerRadius" Value="4"/>
                  <Setter Property="Padding" Value="6,3"/>
                </Style>
                <Style Selector="TextBox:focus">
                  <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundAccentBrush}"/>
                  <Setter Property="BorderThickness" Value="2"/>
                </Style>
                <Style Selector="TextBlock">
                  <Setter Property="FontSize" Value="12"/>
                  <Setter Property="VerticalAlignment" Value="Center"/>
                  <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                  <Setter Property="Margin" Value="4,0"/>
                </Style>
                <Style Selector="Button">
                  <Setter Property="FontSize" Value="11"/>
                  <Setter Property="Padding" Value="8,3"/>
                  <Setter Property="CornerRadius" Value="4"/>
                  <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseLowBrush}"/>
                  <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}"/>
                  <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"/>
                </Style>
                <Style Selector="Button:pointerover">
                  <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"/>
                </Style>
                <Style Selector="Button.delete-button">
                  <Setter Property="Background" Value="{DynamicResource SystemControlErrorTextBrush}"/>
                  <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundChromeWhiteBrush}"/>
                  <Setter Property="BorderBrush" Value="{DynamicResource SystemControlErrorTextBrush}"/>
                </Style>
                <Style Selector="Button.delete-button:pointerover">
                  <Setter Property="Background" Value="{DynamicResource SystemControlErrorTextBrush}"/>
                  <Setter Property="Opacity" Value="0.8"/>
                </Style>
              </Grid.Styles>
              
              <!-- 非编辑模式 -->
              <TextBlock Grid.Column="0" Text="{Binding Date, StringFormat=M/d HH:mm}">
                <TextBlock.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}" ConverterParameter="Not">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBlock.IsVisible>
              </TextBlock>
              <TextBlock Grid.Column="1" Text="{Binding Class}">
                <TextBlock.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}" ConverterParameter="Not">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBlock.IsVisible>
              </TextBlock>
              <TextBlock Grid.Column="2" Text="{Binding StudentId}">
                <TextBlock.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}" ConverterParameter="Not">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBlock.IsVisible>
              </TextBlock>
              <TextBlock Grid.Column="3" Text="{Binding Name}">
                <TextBlock.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}" ConverterParameter="Not">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBlock.IsVisible>
              </TextBlock>
              <TextBlock Grid.Column="4" Text="{Binding Score}">
                <TextBlock.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}" ConverterParameter="Not">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBlock.IsVisible>
              </TextBlock>
              <TextBlock Grid.Column="5" Text="{Binding TeacherName}">
                <TextBlock.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}" ConverterParameter="Not">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBlock.IsVisible>
              </TextBlock>
              <TextBlock Grid.Column="6" Text="{Binding Remark}" TextTrimming="CharacterEllipsis" MaxWidth="150">
                <TextBlock.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}" ConverterParameter="Not">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBlock.IsVisible>
              </TextBlock>

              <!-- 编辑模式 - 主题适配版本 -->
              <!-- 日期不可编辑，显示为只读文本 -->
              <Border Grid.Column="0" 
                      Background="{DynamicResource SystemControlBackgroundBaseMediumLowBrush}"
                      CornerRadius="6"
                      Padding="8,4"
                      ToolTip.Tip="日期不可更改">
                <Border.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </Border.IsVisible>
                <TextBlock Text="{Binding Date, StringFormat=M/d HH:mm}" 
                          FontSize="12"
                          Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                          VerticalAlignment="Center"/>
              </Border>
              <TextBox Grid.Column="1" Text="{Binding Class, Mode=TwoWay}">
                <TextBox.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBox.IsVisible>
              </TextBox>
              <TextBox Grid.Column="2" Text="{Binding StudentId, Mode=TwoWay}">
                <TextBox.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBox.IsVisible>
              </TextBox>
              <TextBox Grid.Column="3" Text="{Binding Name, Mode=TwoWay}">
                <TextBox.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBox.IsVisible>
              </TextBox>
              <TextBox Grid.Column="4" Text="{Binding Score, Mode=TwoWay}">
                <TextBox.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBox.IsVisible>
              </TextBox>
              <TextBox Grid.Column="5" Text="{Binding TeacherName, Mode=TwoWay}">
                <TextBox.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBox.IsVisible>
              </TextBox>
              <TextBox Grid.Column="6" Text="{Binding Remark, Mode=TwoWay}">
                <TextBox.IsVisible>
                  <MultiBinding Converter="{StaticResource EqualsConverter}">
                    <Binding Path="#Root.DataContext.EditingId"/>
                    <Binding Path="Id"/>
                  </MultiBinding>
                </TextBox.IsVisible>
              </TextBox>

              <!-- 操作按钮 -->
              <StackPanel Grid.Column="7" Orientation="Horizontal" Spacing="4">
                <!-- 非编辑状态的按钮 -->
                <Button Content="✎" FontSize="12" Padding="4,2" Command="{Binding #Root.DataContext.EditCommand}" CommandParameter="{Binding}">
                  <Button.IsVisible>
                    <MultiBinding Converter="{StaticResource EqualsConverter}" ConverterParameter="Not">
                      <Binding Path="#Root.DataContext.EditingId"/>
                      <Binding Path="Id"/>
                    </MultiBinding>
                  </Button.IsVisible>
                </Button>
                <Button Content="🗑" 
                       FontSize="12" 
                       Padding="4,2" 
                       Classes="delete-button"
                       Command="{Binding #Root.DataContext.DeleteCommand}" 
                       CommandParameter="{Binding}">
                  <Button.IsVisible>
                    <MultiBinding Converter="{StaticResource EqualsConverter}" ConverterParameter="Not">
                      <Binding Path="#Root.DataContext.EditingId"/>
                      <Binding Path="Id"/>
                    </MultiBinding>
                  </Button.IsVisible>
                </Button>
                
                <!-- 编辑状态的按钮 -->
                <Button Content="✓" FontSize="12" Padding="4,2" Command="{Binding #Root.DataContext.SaveCommand}" CommandParameter="{Binding}">
                  <Button.IsVisible>
                    <MultiBinding Converter="{StaticResource EqualsConverter}">
                      <Binding Path="#Root.DataContext.EditingId"/>
                      <Binding Path="Id"/>
                    </MultiBinding>
                  </Button.IsVisible>
                </Button>
                <Button Content="✗" FontSize="12" Padding="4,2" Command="{Binding #Root.DataContext.CancelCommand}">
                  <Button.IsVisible>
                    <MultiBinding Converter="{StaticResource EqualsConverter}">
                      <Binding Path="#Root.DataContext.EditingId"/>
                      <Binding Path="Id"/>
                    </MultiBinding>
                  </Button.IsVisible>
                </Button>
              </StackPanel>
            </Grid>
          </DataTemplate>
        </ListBox.ItemTemplate>
      </ListBox>
    </StackPanel>
    </Border>
  </ScrollViewer>
</UserControl>
