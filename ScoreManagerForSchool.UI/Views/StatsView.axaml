<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:ScoreManagerForSchool.UI.ViewModels"
             xmlns:core="using:ScoreManagerForSchool.Core.Storage"
             x:Class="ScoreManagerForSchool.UI.Views.StatsView"
             x:DataType="vm:StatsViewModel">
  <ScrollViewer>
    <StackPanel Margin="12" Spacing="8">
    <TextBlock Text="ç§¯åˆ†ç»Ÿè®¡" FontSize="20" FontWeight="Bold"/>
    <StackPanel Orientation="Horizontal" Spacing="8">
      <Button Content="åˆ·æ–°" Command="{Binding RefreshCommand}"/>
      <Button Content="å¯¼å‡ºæŠ¥è¡¨" Command="{Binding ExportCommand}"/>
      <StackPanel Orientation="Horizontal" Spacing="4">
        <TextBlock Text="å…³é”®ç§¯åˆ†é˜ˆå€¼:" VerticalAlignment="Center"/>
        <TextBox Width="80" Text="{Binding CriticalScoreThreshold}" VerticalAlignment="Center"/>
        <TextBlock Text="(â‰¤æ­¤å€¼å°†æ ‡çº¢)" Foreground="#666" VerticalAlignment="Center" FontSize="11"/>
      </StackPanel>
    </StackPanel>

    <!-- å¾…å¤„ç†é¡¹ï¼ˆæœ€å¤šæ˜¾ç¤ºä¸‰ä¸ªï¼‰ -->
    <StackPanel>
      <TextBlock Text="å¾…å¤„ç†" FontWeight="SemiBold" Margin="0,6,0,2"/>
      <Border IsVisible="{Binding PendingTop.Count, Converter={StaticResource EqualsConverter}, ConverterParameter=0}" Padding="8" BorderBrush="#DDD" BorderThickness="1" CornerRadius="6">
        <TextBlock Text="æš‚æ— æ•°æ®" Foreground="#888"/>
      </Border>
      <ItemsControl ItemsSource="{Binding PendingTop}">
        <ItemsControl.ItemTemplate>
          <DataTemplate x:DataType="core:EvaluationEntry">
            <Grid ColumnDefinitions="160,*,140,Auto,Auto" Margin="0,2">
              <TextBlock Grid.Column="0" Text="{Binding Class}"/>
              <TextBlock Grid.Column="1" Text="{Binding Remark}"/>
              <TextBlock Grid.Column="2" Text="{Binding Date, StringFormat=yyyy-MM-dd HH:mm}"/>
              <Button Grid.Column="3" Content="å¤„ç†" Click="OnProcessPendingClick"/>
              <Button Grid.Column="4" Content="åˆ é™¤" Click="OnDeletePendingClick"/>
            </Grid>
          </DataTemplate>
        </ItemsControl.ItemTemplate>
      </ItemsControl>
    </StackPanel>

    <!-- æ±‡æ€»è¡¨ -->
  <Grid ColumnDefinitions="*" RowDefinitions="Auto,Auto,*" RowSpacing="4" ColumnSpacing="8">
      <StackPanel Orientation="Horizontal" Spacing="12">
        <Button Content="æŒ‰åˆ†æ•°æŽ’åº" Command="{Binding SortCommand}" CommandParameter="Score"/>
        <Button Content="æŒ‰ç­çº§æŽ’åº" Command="{Binding SortCommand}" CommandParameter="Class"/>
        <Button Content="æŒ‰å”¯ä¸€å·æŽ’åº" Command="{Binding SortCommand}" CommandParameter="Id"/>
        <Button Content="æŒ‰å§“åæŽ’åº" Command="{Binding SortCommand}" CommandParameter="Name"/>
      </StackPanel>
  <Grid Grid.Row="1" ColumnDefinitions="200,220,*,140,100" Margin="0,2" HorizontalAlignment="Stretch">
        <TextBlock Grid.Column="0" Text="ç­çº§" FontWeight="SemiBold"/>
        <TextBlock Grid.Column="1" Text="å”¯ä¸€å·" FontWeight="SemiBold"/>
        <TextBlock Grid.Column="2" Text="å§“å" FontWeight="SemiBold"/>
        <TextBlock Grid.Column="3" Text="ç´¯è®¡ç§¯åˆ†" FontWeight="SemiBold"/>
        <TextBlock Grid.Column="4" Text="è®°å½•æ•°" FontWeight="SemiBold"/>
      </Grid>
  <Border Grid.Row="2" IsVisible="{Binding Summary.Count, Converter={StaticResource EqualsConverter}, ConverterParameter=0}" Padding="8" BorderBrush="#DDD" BorderThickness="1" CornerRadius="6" Margin="0,4,0,0">
      <TextBlock Text="æš‚æ— æ•°æ®" Foreground="#888"/>
    </Border>
  <ListBox Grid.Row="2" ItemsSource="{Binding Summary}" Height="360" HorizontalAlignment="Stretch">
        <ListBox.Styles>
          <Style Selector="ListBoxItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
          </Style>
        </ListBox.Styles>
        <ListBox.ItemTemplate>
          <DataTemplate x:DataType="vm:StatsSummaryItem">
            <Border Background="{Binding IsCritical, Converter={StaticResource BoolToColorConverter}}" 
                    CornerRadius="4" Padding="4,2">
              <Grid ColumnDefinitions="200,220,*,140,100,Auto" Margin="0,2">
                <TextBlock Grid.Column="0" Text="{Binding Class}" 
                           Foreground="{Binding IsCritical, Converter={StaticResource BoolToTextColorConverter}}"/>
                <TextBlock Grid.Column="1" Text="{Binding Id}" 
                           Foreground="{Binding IsCritical, Converter={StaticResource BoolToTextColorConverter}}"/>
                <TextBlock Grid.Column="2" Text="{Binding Name}" 
                           Foreground="{Binding IsCritical, Converter={StaticResource BoolToTextColorConverter}}"/>
                <TextBlock Grid.Column="3" Text="{Binding TotalScore}" 
                           Foreground="{Binding IsCritical, Converter={StaticResource BoolToTextColorConverter}}"
                           FontWeight="{Binding IsCritical, Converter={StaticResource BoolToFontWeightConverter}}"/>
                <TextBlock Grid.Column="4" Text="{Binding Count}" HorizontalAlignment="Right" 
                           Foreground="{Binding IsCritical, Converter={StaticResource BoolToTextColorConverter}}"/>
                <StackPanel Grid.Column="5" Orientation="Horizontal" Spacing="6">
                  <Button Content="âœŽ" Click="OnEditSummaryClick"/>
                  <Button Content="ðŸ—‘" Click="OnDeleteSummaryClick"/>
                </StackPanel>
              </Grid>
            </Border>
          </DataTemplate>
        </ListBox.ItemTemplate>
  </ListBox>
    </Grid>
    </StackPanel>
  </ScrollViewer>
</UserControl>
