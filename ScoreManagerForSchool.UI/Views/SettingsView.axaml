<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:ScoreManagerForSchool.UI.ViewModels"
             xmlns:controls="using:ScoreManagerForSchool.UI.Controls"
             x:Class="ScoreManagerForSchool.UI.Views.SettingsView"
             x:DataType="vm:SettingsViewModel">
  
  <ScrollViewer VerticalScrollBarVisibility="Visible" 
                HorizontalScrollBarVisibility="Disabled"
                Background="Transparent"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
    <StackPanel Margin="20" Spacing="25" MinWidth="400" MaxWidth="800">
      
      <!-- 页面标题 -->
      <TextBlock Text="设置" FontSize="28" FontWeight="Bold" Margin="0,0,0,15"/>

      <!-- 启动与更新（前置） -->
      <Border BorderBrush="#DDD" BorderThickness="1" CornerRadius="8" Padding="25">
        <StackPanel Spacing="18">
          <TextBlock Text="启动与更新" FontWeight="SemiBold" FontSize="18"/>
          
          <CheckBox IsChecked="{Binding AutoStart}" Content="开机自启动（Windows）"/>
          
          <Grid ColumnDefinitions="Auto,160,*,Auto" ColumnSpacing="12" RowDefinitions="Auto,Auto" RowSpacing="12">
            <CheckBox Grid.Row="0" Grid.Column="0" IsChecked="{Binding AutoUpdateCheck}" 
                      Content="自动检查更新" VerticalAlignment="Center"/>
            <ComboBox Grid.Row="0" Grid.Column="1" ItemsSource="{Binding UpdateSourceOptions}" 
                      SelectedItem="{Binding UpdateSource}"/>
            <TextBox Grid.Row="0" Grid.Column="2" Text="{Binding UpdateFeedUrl}" 
                     Watermark="自定义源 ver.txt URL" Margin="0,0,10,0"
                     IsVisible="{Binding UpdateSource, Converter={StaticResource EqualsConverter}, ConverterParameter=Custom}"/>
            <Button Grid.Row="0" Grid.Column="3" Content="立即检查" Command="{Binding CheckUpdateCommand}"/>
            
            <TextBlock Grid.Row="1" Grid.ColumnSpan="4" TextWrapping="Wrap" Opacity="0.7" FontSize="12"
                       Text="源说明：GitHub 为原始地址；Ghproxy 为加速（形如 https://gh-proxy.com/https://github.com/...）；自定义需直接填写 ver.txt 的下载地址。"/>
          </Grid>
        </StackPanel>
      </Border>

      <!-- 更改密码 -->
      <Border BorderBrush="#DDD" BorderThickness="1" CornerRadius="8" Padding="25">
        <StackPanel Spacing="18">
          <TextBlock Text="更改密码" FontWeight="SemiBold" FontSize="18"/>
          <controls:PasswordTextBox Watermark="当前用户密码（用于验证）" Text="{Binding CurrentUserPassword, Mode=TwoWay}"/>
          <controls:PasswordTextBox Watermark="新用户密码（至少 8 位）" Text="{Binding NewUserPassword, Mode=TwoWay}"/>
          <controls:PasswordTextBox Watermark="新用户密码确认" Text="{Binding NewUserPasswordConfirm, Mode=TwoWay}"/>
          <Button Content="更改密码" Command="{Binding ChangePasswordCommand}" HorizontalAlignment="Left"/>
        </StackPanel>
      </Border>

      <!-- 主题设置 -->
      <Border BorderBrush="#DDD" BorderThickness="1" CornerRadius="8" Padding="25">
        <StackPanel Spacing="18">
          <TextBlock Text="主题设置" FontWeight="SemiBold" FontSize="18"/>
          <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto" RowSpacing="15" ColumnSpacing="18">
            
            <TextBlock Text="主题：" Grid.Row="0" VerticalAlignment="Center"/>
            <ComboBox Grid.Column="1" Grid.Row="0" ItemsSource="{Binding ThemeOptions}" 
                      SelectedItem="{Binding Theme}" MinWidth="150" HorizontalAlignment="Left"/>
            
            <TextBlock Text="强调色：" Grid.Row="1" VerticalAlignment="Center"/>
            <TextBox Grid.Column="1" Grid.Row="1" Text="{Binding ThemeAccent}" 
                     MinWidth="150" HorizontalAlignment="Left" Watermark="#0078D4"/>
            
            <CheckBox Grid.Column="0" Grid.ColumnSpan="2" Grid.Row="2" 
                      IsChecked="{Binding EnableAcrylicEffect}" 
                      Content="启用窗口亚克力效果（毛玻璃背景）"/>
          </Grid>
        </StackPanel>
      </Border>

      <!-- 安全与存储（后置） -->
      <Border BorderBrush="#DDD" BorderThickness="1" CornerRadius="8" Padding="25">
        <StackPanel Spacing="18">
          <TextBlock Text="安全与存储" FontWeight="SemiBold" FontSize="18"/>
          <TextBlock Text="重置将删除 base 目录中的 Database1、提示、学生、班级与方案文件。" 
                     TextWrapping="Wrap" Foreground="Gray"/>
          <StackPanel Orientation="Horizontal" Spacing="10">
            <Button Background="#C43E3E" Foreground="White" Content="重置基础数据文件" Click="OnResetClicked"/>
          </StackPanel>
        </StackPanel>
      </Border>
      
      <!-- 底部间距 -->
      <Rectangle Height="30" Fill="Transparent"/>
      
    </StackPanel>
  </ScrollViewer>
</UserControl>
